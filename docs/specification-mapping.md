# 仕様書と実装計画の対応表

このドキュメントは、仕様書の各セクションが実装計画のどのIssueに対応するかを示したクイックリファレンスです。

## ゲームルール仕様書（hanafuda-specification.md）の対応

| 仕様書セクション | 実装計画Issue | 備考 |
|----------------|--------------|------|
| 2. 花札の構成 | Issue #2, #3 | 札のデータモデルと定義 |
| 2.2 各月の札 | Issue #3 | CardDefinitionsでの48枚定義 |
| 3. ゲームの準備 | Issue #5, #11 | 山札管理、配札、検証 |
| 3.2 親決め | Issue #10 | ゲーム初期化 |
| 3.3 札の配布 | Issue #5 | 配札ロジック |
| 3.4 配札の確認 | Issue #11, #18 | 配札検証、再配札 |
| 4. ゲームの進行 | Issue #8, #10 | ターン進行の基本ロジック |
| 4.1 ターンの流れ | Issue #8 | ステップ1-4の実装 |
| 4.2 特殊な状況 - 喰い付き | Issue #14 | 喰い付きハンドラー |
| 4.2 特殊な状況 - 手四 | Issue #20 | 手四ハンドラー（オプション） |
| 4.2 特殊な状況 - 総流れ | Issue #17 | 総流れハンドラー |
| 5. こいこいの選択 | Issue #13 | こいこいの宣言と処理 |
| 5.1 役完成時の選択 | Issue #13 | 勝負/こいこいの選択 |
| 5.2 こいこいのリスクとリターン | Issue #7, #13 | 得点計算、こいこいボーナス |
| 6.1 光札の役 | Issue #6 | 五光、四光、雨四光、三光 |
| 6.2 種札の役 | Issue #6, #15 | 基本種判定と特殊役 |
| 6.3 短冊札の役 | Issue #6, #16 | 基本短冊判定と赤短・青短 |
| 6.4 カス札の役 | Issue #6 | カス判定 |
| 6.5 役の複合 | Issue #6 | 重複カウントロジック |
| 7. 得点計算 | Issue #7 | ScoreCalculator |
| 7.1 基本の得点計算 | Issue #7 | 通常得点 |
| 7.2 得点の例 | Issue #7 | テストケース |
| 8. ゲームの終了 | Issue #11 | 勝敗判定 |
| 8.1 終了条件 | Issue #11, #17 | 勝負宣言、総流れ |
| 8.2 親の交代 | Issue #11 | 親の交代ロジック |
| 10. 変則ルール | Issue #21 | ルール設定のカスタマイズ |

## 実装仕様書（implementation-specification.md）の対応

| 仕様書セクション | 実装計画Issue | 備考 |
|----------------|--------------|------|
| 2. システムアーキテクチャ | Issue #1 | プロジェクト構造 |
| 2.1 レイヤー構成 | Issue #1 | Core/Domain/Facadeの分離 |
| 2.2 主要コンポーネント | Issue #2-11 | 各コンポーネントの実装 |
| 3.1 基本的な値オブジェクト | Issue #2 | Month, CardType, Card等 |
| 3.2 札のコレクション定義 | Issue #3 | CardDefinitions |
| 3.3 役（Yaku） | Issue #2, #6 | YakuType, Yaku |
| 3.4 ゲーム状態 | Issue #4 | GameState, PlayerState等 |
| 4. ゲームフロー | Issue #8, #10 | ターン進行とゲーム管理 |
| 4.1 ゲーム初期化 | Issue #5, #10 | 配札とゲーム開始 |
| 4.2 ターンの進行 | Issue #8 | TurnManager |
| 5.1 KoiKoiGame | Issue #10 | ファサードクラス |
| 5.2 IGameAction | Issue #9 | アクションインターフェース |
| 5.3 GameActionResult | Issue #9, #10 | アクション実行結果 |
| 5.4 GameEvent | Issue #22 | ゲームイベント |
| 6. 役判定アルゴリズム | Issue #6, #15, #16 | YakuEvaluator |
| 7. 得点計算 | Issue #7 | ScoreCalculator |
| 8. アクション検証 | Issue #9 | ActionValidator |
| 9.1 喰い付き | Issue #14 | KuitsukiHandler |
| 9.2 手四 | Issue #20 | TeshiHandler |
| 9.3 総流れ | Issue #17 | DrawHandler |
| 9.4 配札の検証 | Issue #11, #18 | DealingValidator |
| 10. テスト戦略 | Issue #12, #19, #23, #27 | 各フェーズの統合テスト |
| 11. 拡張性と変則ルール | Issue #21 | GameRules |
| 13. エラーハンドリング | Issue #28 | カスタム例外 |
| 14. パフォーマンス考慮事項 | Issue #24 | 最適化 |
| 15. 実装の優先順位 | - | 実装計画のフェーズ分け |
| 付録A: プロジェクト構造例 | Issue #1 | ディレクトリ構造 |

## フェーズごとの実装範囲

### フェーズ1: 基本機能（MVP）
**対応する仕様書の範囲:**
- 花札の構成と定義（全48枚）
- ゲームの準備（配札、親決め）
- 基本的なターンの流れ
- 光札の役（五光、四光、雨四光、三光）
- 種、短冊、カスの基本役判定
- 基本的な得点計算
- 勝敗判定

**完成基準:**
- 手札を出して札を取得できる
- 基本的な役が判定される
- 得点が正しく計算される
- ゲームが開始から終了まで動作する

### フェーズ2: 完全なルール実装
**対応する仕様書の範囲:**
- こいこいの選択と処理
- 喰い付き
- 特殊な役（猪鹿蝶、花見で一杯、月見で一杯、赤短、青短）
- 総流れ
- 配札の再検証

**完成基準:**
- こいこい機能が完全動作
- 全ての役が正しく判定される
- 特殊ルールが正しく処理される

### フェーズ3: 拡張機能
**対応する仕様書の範囲:**
- 手四（オプション）
- 変則ルール（得点のカスタマイズ）
- イベントシステム

**完成基準:**
- ルールをカスタマイズできる
- ゲームイベントが記録される

### フェーズ4: 高度な機能
**対応する仕様書の範囲:**
- パフォーマンス最適化
- 詳細なログ
- リプレイ機能

**完成基準:**
- パフォーマンスが基準を満たす
- 完全なドキュメントが整備される

## 優先度の判断基準

### 優先度: 高（Priority High）
- MVPに必須の機能
- 他の多くのIssueが依存する基礎的な機能
- ゲームの基本動作に必要な機能

**該当Issue:**
#1, #2, #3, #4, #5, #6, #7, #8, #9, #10, #11, #12, #13, #19

### 優先度: 中（Priority Medium）
- 完全なルール実装に必要な機能
- 拡張性のために重要な機能
- ドキュメントやCI/CD

**該当Issue:**
#15, #16, #17, #18, #21, #22, #28, #29, #30

### 優先度: 低（Priority Low）
- オプション機能
- 高度な機能
- パフォーマンス最適化

**該当Issue:**
#20, #23, #24, #25, #26, #27

## 依存関係グラフ

```
#1 (プロジェクト構造)
├── #2 (データモデル)
│   ├── #3 (札の定義)
│   │   ├── #5 (山札管理)
│   │   │   └── #11 (配札検証)
│   │   │       ├── #17 (総流れ)
│   │   │       └── #18 (再配札)
│   │   └── #6 (基本役判定)
│   │       ├── #7 (得点計算)
│   │       ├── #15 (特殊役：種)
│   │       └── #16 (特殊役：短冊)
│   └── #4 (状態管理)
│       ├── #8 (ターン進行)
│       │   └── #10 (ファサード)
│       │       ├── #11 (配札検証)
│       │       ├── #12 (MVP統合テスト)
│       │       │   ├── #13 (こいこい)
│       │       │   └── #14 (喰い付き)
│       │       └── #22 (イベント)
│       │           ├── #25 (ログ)
│       │           └── #26 (リプレイ)
│       └── #9 (アクション)
│           ├── #10 (ファサード)
│           └── #28 (エラーハンドリング)
└── #30 (CI/CD)

#19 (フェーズ2統合) → #20 (手四) → #23 (フェーズ3統合) → #24 (最適化) → #27 (フェーズ4統合)
                   → #21 (ルール設定) ↗                  → #25 (ログ) ↗
                                                          → #26 (リプレイ) ↗

#19 → #29 (APIリファレンス)
```

## 並行実装可能なIssueグループ

### グループ1（フェーズ1初期）
- Issue #2（データモデル）
- Issue #4（状態管理）
- Issue #30（CI/CD）

### グループ2（フェーズ1中期）
- Issue #6（役判定）
- Issue #8（ターン進行）

### グループ3（フェーズ2）
- Issue #14（喰い付き）
- Issue #15（特殊役：種）
- Issue #16（特殊役：短冊）

### グループ4（フェーズ2）
- Issue #17（総流れ）
- Issue #18（再配札）

### グループ5（フェーズ3）
- Issue #20（手四）
- Issue #21（ルール設定）
- Issue #22（イベント）

### グループ6（フェーズ4）
- Issue #24（最適化）
- Issue #25（ログ）
- Issue #26（リプレイ）

## クリティカルパス

最速でMVPを完成させるためのクリティカルパスは以下の通りです：

```
#1 → #2 → #3 → #5 → #6 → #7 → #4 → #8 → #9 → #10 → #11 → #12
```

推定期間: 約60-75時間（2-3週間）

---

**作成日**: 2025-11-17  
**バージョン**: 1.0
