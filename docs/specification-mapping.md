# 仕様書と実装計画の対応表

このドキュメントは、仕様書の各セクションが実装計画のどのIssueに対応するかを示したクイックリファレンスです。

## ゲームルール仕様書（hanafuda-specification.md）の対応

| 仕様書セクション | 実装計画Issue | 備考 |
|----------------|--------------|------|
| 2. 花札の構成 | | 札のデータモデルと定義 |
| 2.2 各月の札 | | CardDefinitionsでの48枚定義 |
| 3. ゲームの準備 | | 山札管理、配札、検証 |
| 3.2 親決め | | ゲーム初期化 |
| 3.3 札の配布 | | 配札ロジック |
| 3.4 配札の確認 | | 配札検証、再配札 |
| 4. ゲームの進行 | | ターン進行の基本ロジック |
| 4.1 ターンの流れ | | ステップ1-4の実装 |
| 4.2 特殊な状況 - 喰い付き | | 喰い付きハンドラー |
| 4.2 特殊な状況 - 手四 | | 手四ハンドラー（オプション） |
| 4.2 特殊な状況 - 総流れ | | 総流れハンドラー |
| 5. こいこいの選択 | | こいこいの宣言と処理 |
| 5.1 役完成時の選択 | | 勝負/こいこいの選択 |
| 5.2 こいこいのリスクとリターン | | 得点計算、こいこいボーナス |
| 6.1 光札の役 | | 五光、四光、雨四光、三光 |
| 6.2 種札の役 | | 基本種判定と特殊役 |
| 6.3 短冊札の役 | | 基本短冊判定と赤短・青短 |
| 6.4 カス札の役 | | カス判定 |
| 6.5 役の複合 | | 重複カウントロジック |
| 7. 得点計算 | | ScoreCalculator |
| 7.1 基本の得点計算 | | 通常得点 |
| 7.2 得点の例 | | テストケース |
| 8. ゲームの終了 | | 勝敗判定 |
| 8.1 終了条件 | | 勝負宣言、総流れ |
| 8.2 親の交代 | | 親の交代ロジック |
| 10. 変則ルール | | ルール設定のカスタマイズ |

## 実装仕様書（implementation-specification.md）の対応

| 仕様書セクション | 実装計画Issue | 備考 |
|----------------|--------------|------|
| 2. システムアーキテクチャ | | プロジェクト構造 |
| 2.1 レイヤー構成 | | Core/Domain/Facadeの分離 |
| 2.2 主要コンポーネント | Issue #9-11 | 各コンポーネントの実装 |
| 3.1 基本的な値オブジェクト | | Month, CardType, Card等 |
| 3.2 札のコレクション定義 | | CardDefinitions |
| 3.3 役（Yaku） | | YakuType, Yaku |
| 3.4 ゲーム状態 | | GameState, PlayerState等 |
| 4. ゲームフロー | | ターン進行とゲーム管理 |
| 4.1 ゲーム初期化 | | 配札とゲーム開始 |
| 4.2 ターンの進行 | | TurnManager |
| 5.1 KoiKoiGame | | ファサードクラス |
| 5.2 IGameAction | | アクションインターフェース |
| 5.3 GameActionResult | | アクション実行結果 |
| 5.4 GameEvent | | ゲームイベント |
| 6. 役判定アルゴリズム | | YakuEvaluator |
| 7. 得点計算 | | ScoreCalculator |
| 8. アクション検証 | | ActionValidator |
| 9.1 喰い付き | | KuitsukiHandler |
| 9.2 手四 | | TeshiHandler |
| 9.3 総流れ | | DrawHandler |
| 9.4 配札の検証 | | DealingValidator |
| 10. テスト戦略 | | 各フェーズの統合テスト |
| 11. 拡張性と変則ルール | | GameRules |
| 13. エラーハンドリング | | カスタム例外 |
| 14. パフォーマンス考慮事項 | | 最適化 |
| 15. 実装の優先順位 | - | 実装計画のフェーズ分け |
| 付録A: プロジェクト構造例 | | ディレクトリ構造 |

## フェーズごとの実装範囲

### フェーズ1: 基本機能（MVP）
**対応する仕様書の範囲:**
- 花札の構成と定義（全48枚）
- ゲームの準備（配札、親決め）
- 基本的なターンの流れ
- 光札の役（五光、四光、雨四光、三光）
- 種、短冊、カスの基本役判定
- 基本的な得点計算
- 勝敗判定

**完成基準:**
- 手札を出して札を取得できる
- 基本的な役が判定される
- 得点が正しく計算される
- ゲームが開始から終了まで動作する

### フェーズ2: 完全なルール実装
**対応する仕様書の範囲:**
- こいこいの選択と処理
- 喰い付き
- 特殊な役（猪鹿蝶、花見で一杯、月見で一杯、赤短、青短）
- 総流れ
- 配札の再検証

**完成基準:**
- こいこい機能が完全動作
- 全ての役が正しく判定される
- 特殊ルールが正しく処理される

### フェーズ3: 拡張機能
**対応する仕様書の範囲:**
- 手四（オプション）
- 変則ルール（得点のカスタマイズ）
- イベントシステム

**完成基準:**
- ルールをカスタマイズできる
- ゲームイベントが記録される

### フェーズ4: 高度な機能
**対応する仕様書の範囲:**
- パフォーマンス最適化
- 詳細なログ
- リプレイ機能

**完成基準:**
- パフォーマンスが基準を満たす
- 完全なドキュメントが整備される

## 優先度の判断基準

### 優先度: 高（Priority High）
- MVPに必須の機能
- 他の多くのIssueが依存する基礎的な機能
- ゲームの基本動作に必要な機能

**該当Issue:**
#8, #9, #10, #11, #12, #13, #14, #15, #16, #17, #18, #19, #20, #26

### 優先度: 中（Priority Medium）
- 完全なルール実装に必要な機能
- 拡張性のために重要な機能
- ドキュメントやCI/CD

**該当Issue:**
#22, #23, #24, #25, #28, #29, #35, #36, #37

### 優先度: 低（Priority Low）
- オプション機能
- 高度な機能
- パフォーマンス最適化

**該当Issue:**
#27, #30, #31, #32, #33, #34

## 依存関係グラフ

```
#8 (プロジェクト構造)
├── #9 (データモデル)
│   ├── #10 (札の定義)
│   │   ├── #12 (山札管理)
│   │   │   └── #18 (配札検証)
│   │   │       ├── #24 (総流れ)
│   │   │       └── #25 (再配札)
│   │   └── #13 (基本役判定)
│   │       ├── #14 (得点計算)
│   │       ├── #22 (特殊役：種)
│   │       └── #23 (特殊役：短冊)
│   └── #11 (状態管理)
│       ├── #15 (ターン進行)
│       │   └── #17 (ファサード)
│       │       ├── #18 (配札検証)
│       │       ├── #19 (MVP統合テスト)
│       │       │   ├── #20 (こいこい)
│       │       │   └── #21 (喰い付き)
│       │       └── #29 (イベント)
│       │           ├── #32 (ログ)
│       │           └── #33 (リプレイ)
│       └── #16 (アクション)
│           ├── #17 (ファサード)
│           └── #35 (エラーハンドリング)
└── #37 (CI/CD)

#26 (フェーズ2統合) → #27 (手四) → #30 (フェーズ3統合) → #31 (最適化) → #34 (フェーズ4統合)
                   → #28 (ルール設定) ↗                  → #32 (ログ) ↗
                                                          → #33 (リプレイ) ↗

#26 → #36 (APIリファレンス)
```

## 並行実装可能なIssueグループ

### グループ1（フェーズ1初期）
- Issue #9（データモデル）
- Issue #11（状態管理）
- Issue #37（CI/CD）

### グループ2（フェーズ1中期）
- Issue #13（役判定）
- Issue #15（ターン進行）

### グループ3（フェーズ2）
- Issue #21（喰い付き）
- Issue #22（特殊役：種）
- Issue #23（特殊役：短冊）

### グループ4（フェーズ2）
- Issue #24（総流れ）
- Issue #25（再配札）

### グループ5（フェーズ3）
- Issue #27（手四）
- Issue #28（ルール設定）
- Issue #29（イベント）

### グループ6（フェーズ4）
- Issue #31（最適化）
- Issue #32（ログ）
- Issue #33（リプレイ）

## クリティカルパス

最速でMVPを完成させるためのクリティカルパスは以下の通りです：

```
#8 → #9 → #10 → #12 → #13 → #14 → #11 → #15 → #16 → #17 → #18 → #19
```

推定期間: 約60-75時間（2-3週間）

---

**作成日**: 2025-11-17  
**バージョン**: 1.0
